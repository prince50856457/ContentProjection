<div class="extractor-container">
  <header class="main-header">
    <h1>Content Extractor & AI Analyst</h1>
    <p>Paste a URL to an article or blog post to extract its key ideas and discover related concepts.</p>
  </header>

  <div class="input-form">
    <input 
      type="text" 
      [value]="url()"
      (input)="onUrlChange($event)"
      placeholder="e.g., https://angular.dev/blog/angular-v17-is-now-available"
    />
    <button (click)="extractContent()" [disabled]="isLoading()">
      @if (isLoading()) {
        <span class="spinner"></span>
        <span>Analyzing...</span>
      } @else {
        <span>Extract Content</span>
      }
    </button>
  </div>

  @if (error()) {
    <div class="error-container">
      <p><strong>Error:</strong> {{ error() }}</p>
    </div>
  }

  @if (isLoading()) {
    <div class="loading-container">
      <p>Fetching and analyzing the content. Please wait...</p>
    </div>
  }

  @if (extractedContent() || keyConcepts().length > 0) {
    <div class="results-grid">
      @if (paginatedContent(); as content) {
        <div class="content-section">
          <h2>Extracted Summary</h2>
          <div class="extracted-content">
            @for (block of content; track $index) {
              @switch (block.type) {
                @case ('heading') {
                  @switch (block.level) {
                    @case (1) { <h3>{{ block.text }}</h3> }
                    @case (2) { <h4>{{ block.text }}</h4> }
                    @case (3) { <h5>{{ block.text }}</h5> }
                    @case (4) { <h6>{{ block.text }}</h6> }
                  }
                }
                @case ('paragraph') {
                  <p>{{ block.text }}</p>
                }
                @case ('bullets') {
                  <ul>
                    @for (item of block.items; track $index) {
                      <li>{{ item }}</li>
                    }
                  </ul>
                }
                @case ('code') {
                  <pre><code>{{ block.text }}</code></pre>
                }
              }
            }
          </div>

          <!-- Pagination Controls -->
          @if (totalPages() > 1) {
            <div class="pagination-controls">
              <button (click)="previousPage()" [disabled]="currentPage() === 1">
                &larr; Previous
              </button>
              <span>
                Page {{ currentPage() }} of {{ totalPages() }}
              </span>
              <button (click)="nextPage()" [disabled]="currentPage() === totalPages()">
                Next &rarr;
              </button>
            </div>
          }
        </div>
      }

      <div class="analysis-section">
        @if (keyConcepts().length > 0) {
          <div class="concepts-container">
            <h3>Key Concepts</h3>
            <div class="accordion">
              @for (concept of keyConcepts(); track concept.overview; let i = $index) {
                <div class="accordion-item">
                  <button class="accordion-header" (click)="toggleConcept(i)">
                    <span class="header-text">{{ concept.overview }}</span>
                    <span class="accordion-icon">{{ activeConceptIndex() === i ? 'âˆ’' : '+' }}</span>
                  </button>
                  @if (activeConceptIndex() === i) {
                    <div class="accordion-content">
                      <h4>Explanation</h4>
                      <p>{{ concept.explanation }}</p>

                      <h4>Example</h4>
                      <pre><code>{{ concept.example }}</code></pre>

                      <h4>Common Mistakes / Notes</h4>
                      <p>{{ concept.mistakes }}</p>
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        }

        @if (relatedLinks().length > 0) {
          <div class="links-container">
            <h3>Related Links</h3>
            <ul>
              @for (link of relatedLinks(); track link.url) {
                <li><a [href]="link.url" target="_blank" rel="noopener noreferrer">{{ link.title }}</a></li>
              }
            </ul>
          </div>
        }
      </div>
    </div>
  }
</div>
